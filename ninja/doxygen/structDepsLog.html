<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Ninja: DepsLog Struct Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Ninja
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#friends">Friends</a>  </div>
  <div class="headertitle">
<div class="title">DepsLog Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="DepsLog" -->
<p>As build commands run they can output extra dependency information (e.g.  
 <a href="structDepsLog.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="deps__log_8h_source.html">deps_log.h</a>&gt;</code></p>

<p><a href="structDepsLog-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog_1_1Deps.html">Deps</a></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#a750f013ae662f96e7f2545d213c7f3a0">Close</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const vector&lt; <a class="el" href="structDepsLog_1_1Deps.html">Deps</a> * &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#a849f7a1be3a785babb0089e1466fe874">deps</a> () const </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#a1cb2e94499fbc1a4e3cdc8835c5d2fbd">DepsLog</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structDepsLog_1_1Deps.html">Deps</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#a075043796f88d312004cf5ae74a53c4e">GetDeps</a> (<a class="el" href="structNode.html">Node</a> *node)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#a3d91b6caef537ba9d9b50ecbf09cd4a5">IsDepsEntryLiveFor</a> (<a class="el" href="structNode.html">Node</a> *node)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns if the deps entry for a node is still reachable from the manifest.  <a href="#a3d91b6caef537ba9d9b50ecbf09cd4a5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#a698004cf8030703ddf6b19f8ab7bd50e">Load</a> (const string &amp;path, <a class="el" href="structState.html">State</a> *state, string *err)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const vector&lt; <a class="el" href="structNode.html">Node</a> * &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#a94bb97eecb9d8293ef1c7f19f1a65f1b">nodes</a> () const </td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Used for tests.  <a href="#a94bb97eecb9d8293ef1c7f19f1a65f1b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#af49ad152c2917c7e86742ce335db0263">OpenForWrite</a> (const string &amp;path, string *err)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#a09515578bf5a271a93919c7ff2036001">Recompact</a> (const string &amp;path, string *err)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Rewrite the known log entries, throwing away old data.  <a href="#a09515578bf5a271a93919c7ff2036001"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#a970cd6713ab54b3fff2f9de5255352fc">RecordDeps</a> (<a class="el" href="structNode.html">Node</a> *node, <a class="el" href="timestamp_8h.html#a364f6f32873dd70e259c971fc2e28b73">TimeStamp</a> mtime, const vector&lt; <a class="el" href="structNode.html">Node</a> * &gt; &amp;<a class="el" href="structDepsLog.html#a94bb97eecb9d8293ef1c7f19f1a65f1b">nodes</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#a5f48df80478fb9af806aa7c56946ca81">RecordDeps</a> (<a class="el" href="structNode.html">Node</a> *node, <a class="el" href="timestamp_8h.html#a364f6f32873dd70e259c971fc2e28b73">TimeStamp</a> mtime, int node_count, <a class="el" href="structNode.html">Node</a> **<a class="el" href="structDepsLog.html#a94bb97eecb9d8293ef1c7f19f1a65f1b">nodes</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#a5d1a8f67e5a655323ae73d140376cd71">~DepsLog</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#aa4cc04faa7d2d9256a372f1b067e61ef">RecordId</a> (<a class="el" href="structNode.html">Node</a> *node)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#a35ce8189fffae2b7300d415ce115a0a3">UpdateDeps</a> (int out_id, <a class="el" href="structDepsLog_1_1Deps.html">Deps</a> *<a class="el" href="structDepsLog.html#a849f7a1be3a785babb0089e1466fe874">deps</a>)</td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">vector&lt; <a class="el" href="structDepsLog_1_1Deps.html">Deps</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#af599cdffb987059f53caf7ebc63e41dd">deps_</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Maps id -&gt; deps of that id.  <a href="#af599cdffb987059f53caf7ebc63e41dd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">FILE *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#a95b019cbbc01f5869c86bc790424d834">file_</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#adee980c7d35e5c4b32b669733b4382c4">needs_recompaction_</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">vector&lt; <a class="el" href="structNode.html">Node</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#a6808f42a3e9b5e1a4f0a0664dcebaae3">nodes_</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Maps id -&gt; <a class="el" href="structNode.html" title="Information about a node in the dependency graph: the file, whether it&#39;s dirty, mtime, etc.">Node</a>.  <a href="#a6808f42a3e9b5e1a4f0a0664dcebaae3"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="friends"></a>
Friends</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDepsLog.html#a5aac22285c95db2a3021f748c8aec5b1">DepsLogTest</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>As build commands run they can output extra dependency information (e.g. </p>
<p>header dependencies for C source) dynamically. <a class="el" href="structDepsLog.html" title="As build commands run they can output extra dependency information (e.g.">DepsLog</a> collects that information at build time and uses it for subsequent builds.</p>
<p>The on-disk format is based on two primary design constraints:</p>
<ul>
<li>it must be written to as a stream (during the build, which may be interrupted);</li>
<li>it can be read all at once on startup. (Alternative designs, where it contains indexing information, were considered and discarded as too complicated to implement; if the file is small than reading it fully on startup is acceptable.) Here are some stats from the Windows Chrome dependency files, to help guide the design space. The total text in the files sums to 90mb so some compression is warranted to keep load-time fast. There's about 10k files worth of dependencies that reference about 40k total paths totalling 2mb of unique strings.</li>
</ul>
<p>Based on these stats, here's the current design. The file is structured as version header followed by a sequence of records. Each record is either a path string or a dependency list. Numbering the path strings in file order gives them dense integer ids. A dependency list maps an output id to a list of input ids.</p>
<p>Concretely, a record is: four bytes record length, high bit indicates record type (but max record sizes are capped at 512kB) path records contain the string name of the path, followed by up to 3 padding bytes to align on 4 byte boundaries, followed by the one's complement of the expected index of the record (to detect concurrent writes of multiple ninja processes to the log). dependency records are an array of 4-byte integers [output path id, output path mtime, input path id, input path id...] (The mtime is compared against the on-disk output path mtime to verify the stored data is up-to-date.) If two records reference the same output the latter one in the file wins, allowing updates to just be appended to the file. A separate repacking step can run occasionally to remove dead records. </p>

<p>Definition at line <a class="el" href="deps__log_8h_source.html#l00066">66</a> of file <a class="el" href="deps__log_8h_source.html">deps_log.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a1cb2e94499fbc1a4e3cdc8835c5d2fbd"></a><!-- doxytag: member="DepsLog::DepsLog" ref="a1cb2e94499fbc1a4e3cdc8835c5d2fbd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structDepsLog.html#a1cb2e94499fbc1a4e3cdc8835c5d2fbd">DepsLog::DepsLog</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="deps__log_8h_source.html#l00067">67</a> of file <a class="el" href="deps__log_8h_source.html">deps_log.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5d1a8f67e5a655323ae73d140376cd71"></a><!-- doxytag: member="DepsLog::~DepsLog" ref="a5d1a8f67e5a655323ae73d140376cd71" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structDepsLog.html#a5d1a8f67e5a655323ae73d140376cd71">DepsLog::~DepsLog</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="deps__log_8cc_source.html#l00039">39</a> of file <a class="el" href="deps__log_8cc_source.html">deps_log.cc</a>.</p>

<p>References <a class="el" href="deps__log_8cc_source.html#l00158">Close()</a>.</p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a750f013ae662f96e7f2545d213c7f3a0"></a><!-- doxytag: member="DepsLog::Close" ref="a750f013ae662f96e7f2545d213c7f3a0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="structDepsLog.html#a750f013ae662f96e7f2545d213c7f3a0">DepsLog::Close</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="deps__log_8cc_source.html#l00158">158</a> of file <a class="el" href="deps__log_8cc_source.html">deps_log.cc</a>.</p>

<p>References <a class="el" href="deps__log_8h_source.html#l00111">file_</a>.</p>

<p>Referenced by <a class="el" href="deps__log_8cc_source.html#l00303">Recompact()</a>, <a class="el" href="build__test_8cc_source.html#l01561">TEST_F()</a>, and <a class="el" href="deps__log_8cc_source.html#l00039">~DepsLog()</a>.</p>

</div>
</div>
<a class="anchor" id="a849f7a1be3a785babb0089e1466fe874"></a><!-- doxytag: member="DepsLog::deps" ref="a849f7a1be3a785babb0089e1466fe874" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const vector&lt;<a class="el" href="structDepsLog_1_1Deps.html">Deps</a>*&gt;&amp; <a class="el" href="structDepsLog.html#a849f7a1be3a785babb0089e1466fe874">DepsLog::deps</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="deps__log_8h_source.html#l00101">101</a> of file <a class="el" href="deps__log_8h_source.html">deps_log.h</a>.</p>

<p>Referenced by <a class="el" href="deps__log_8cc_source.html#l00164">Load()</a>, <a class="el" href="deps__log_8cc_source.html#l00303">Recompact()</a>, <a class="el" href="deps__log_8cc_source.html#l00086">RecordDeps()</a>, and <a class="el" href="deps__log_8cc_source.html#l00367">UpdateDeps()</a>.</p>

</div>
</div>
<a class="anchor" id="a075043796f88d312004cf5ae74a53c4e"></a><!-- doxytag: member="DepsLog::GetDeps" ref="a075043796f88d312004cf5ae74a53c4e" args="(Node *node)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structDepsLog_1_1Deps.html">DepsLog::Deps</a> * <a class="el" href="structDepsLog.html#a075043796f88d312004cf5ae74a53c4e">DepsLog::GetDeps</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structNode.html">Node</a> *&#160;</td>
          <td class="paramname"><em>node</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="deps__log_8cc_source.html#l00295">295</a> of file <a class="el" href="deps__log_8cc_source.html">deps_log.cc</a>.</p>

<p>References <a class="el" href="deps__log_8h_source.html#l00116">deps_</a>, and <a class="el" href="graph_8h_source.html#l00083">Node::id()</a>.</p>

<p>Referenced by <a class="el" href="graph_8cc_source.html#l00410">ImplicitDepLoader::LoadDepsFromLog()</a>, and <a class="el" href="deps__log_8cc_source.html#l00086">RecordDeps()</a>.</p>

</div>
</div>
<a class="anchor" id="a3d91b6caef537ba9d9b50ecbf09cd4a5"></a><!-- doxytag: member="DepsLog::IsDepsEntryLiveFor" ref="a3d91b6caef537ba9d9b50ecbf09cd4a5" args="(Node *node)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="structDepsLog.html#a3d91b6caef537ba9d9b50ecbf09cd4a5">DepsLog::IsDepsEntryLiveFor</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structNode.html">Node</a> *&#160;</td>
          <td class="paramname"><em>node</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns if the deps entry for a node is still reachable from the manifest. </p>
<p>The deps log can contain deps entries for files that were built in the past but are no longer part of the manifest. This function returns if this is the case for a given node. This function is slow, don't call it from code that runs on every build. </p>

<p>Definition at line <a class="el" href="deps__log_8cc_source.html#l00357">357</a> of file <a class="el" href="deps__log_8cc_source.html">deps_log.cc</a>.</p>

<p>References <a class="el" href="graph_8cc_source.html#l00283">Edge::GetBinding()</a>, and <a class="el" href="graph_8h_source.html#l00080">Node::in_edge()</a>.</p>

<p>Referenced by <a class="el" href="deps__log_8cc_source.html#l00303">Recompact()</a>.</p>

</div>
</div>
<a class="anchor" id="a698004cf8030703ddf6b19f8ab7bd50e"></a><!-- doxytag: member="DepsLog::Load" ref="a698004cf8030703ddf6b19f8ab7bd50e" args="(const string &amp;path, State *state, string *err)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="structDepsLog.html#a698004cf8030703ddf6b19f8ab7bd50e">DepsLog::Load</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structState.html">State</a> *&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string *&#160;</td>
          <td class="paramname"><em>err</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="deps__log_8cc_source.html#l00164">164</a> of file <a class="el" href="deps__log_8cc_source.html">deps_log.cc</a>.</p>

<p>References <a class="el" href="deps__log_8h_source.html#l00101">deps()</a>, <a class="el" href="state_8cc_source.html#l00114">State::GetNode()</a>, <a class="el" href="graph_8h_source.html#l00083">Node::id()</a>, <a class="el" href="deps__log_8cc_source.html#l00033">kCurrentVersion</a>, <a class="el" href="deps__log_8cc_source.html#l00032">kFileSignature</a>, <a class="el" href="deps__log_8cc_source.html#l00037">kMaxRecordSize</a>, <a class="el" href="metrics_8h_source.html#l00085">METRIC_RECORD</a>, <a class="el" href="deps__log_8h_source.html#l00110">needs_recompaction_</a>, <a class="el" href="deps__log_8h_source.html#l00083">DepsLog::Deps::nodes</a>, <a class="el" href="deps__log_8h_source.html#l00114">nodes_</a>, <a class="el" href="graph_8h_source.html#l00084">Node::set_id()</a>, <a class="el" href="util_8cc_source.html#l00447">Truncate()</a>, and <a class="el" href="deps__log_8cc_source.html#l00367">UpdateDeps()</a>.</p>

<p>Referenced by <a class="el" href="build__test_8cc_source.html#l00479">BuildTest::RebuildTarget()</a>, and <a class="el" href="build__test_8cc_source.html#l01561">TEST_F()</a>.</p>

</div>
</div>
<a class="anchor" id="a94bb97eecb9d8293ef1c7f19f1a65f1b"></a><!-- doxytag: member="DepsLog::nodes" ref="a94bb97eecb9d8293ef1c7f19f1a65f1b" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const vector&lt;<a class="el" href="structNode.html">Node</a>*&gt;&amp; <a class="el" href="structDepsLog.html#a94bb97eecb9d8293ef1c7f19f1a65f1b">DepsLog::nodes</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Used for tests. </p>

<p>Definition at line <a class="el" href="deps__log_8h_source.html#l00100">100</a> of file <a class="el" href="deps__log_8h_source.html">deps_log.h</a>.</p>

</div>
</div>
<a class="anchor" id="af49ad152c2917c7e86742ce335db0263"></a><!-- doxytag: member="DepsLog::OpenForWrite" ref="af49ad152c2917c7e86742ce335db0263" args="(const string &amp;path, string *err)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="structDepsLog.html#af49ad152c2917c7e86742ce335db0263">DepsLog::OpenForWrite</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string *&#160;</td>
          <td class="paramname"><em>err</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="deps__log_8cc_source.html#l00043">43</a> of file <a class="el" href="deps__log_8cc_source.html">deps_log.cc</a>.</p>

<p>References <a class="el" href="deps__log_8h_source.html#l00111">file_</a>, <a class="el" href="deps__log_8cc_source.html#l00033">kCurrentVersion</a>, <a class="el" href="deps__log_8cc_source.html#l00032">kFileSignature</a>, <a class="el" href="deps__log_8cc_source.html#l00037">kMaxRecordSize</a>, <a class="el" href="deps__log_8h_source.html#l00110">needs_recompaction_</a>, <a class="el" href="deps__log_8cc_source.html#l00303">Recompact()</a>, and <a class="el" href="util_8cc_source.html#l00304">SetCloseOnExec()</a>.</p>

<p>Referenced by <a class="el" href="build__test_8cc_source.html#l00479">BuildTest::RebuildTarget()</a>, and <a class="el" href="build__test_8cc_source.html#l01561">TEST_F()</a>.</p>

</div>
</div>
<a class="anchor" id="a09515578bf5a271a93919c7ff2036001"></a><!-- doxytag: member="DepsLog::Recompact" ref="a09515578bf5a271a93919c7ff2036001" args="(const string &amp;path, string *err)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="structDepsLog.html#a09515578bf5a271a93919c7ff2036001">DepsLog::Recompact</a> </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string *&#160;</td>
          <td class="paramname"><em>err</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Rewrite the known log entries, throwing away old data. </p>

<p>Definition at line <a class="el" href="deps__log_8cc_source.html#l00303">303</a> of file <a class="el" href="deps__log_8cc_source.html">deps_log.cc</a>.</p>

<p>References <a class="el" href="deps__log_8cc_source.html#l00158">Close()</a>, <a class="el" href="deps__log_8h_source.html#l00101">deps()</a>, <a class="el" href="deps__log_8h_source.html#l00116">deps_</a>, <a class="el" href="deps__log_8cc_source.html#l00357">IsDepsEntryLiveFor()</a>, <a class="el" href="metrics_8h_source.html#l00085">METRIC_RECORD</a>, <a class="el" href="deps__log_8h_source.html#l00081">DepsLog::Deps::mtime</a>, <a class="el" href="deps__log_8h_source.html#l00082">DepsLog::Deps::node_count</a>, <a class="el" href="deps__log_8h_source.html#l00083">DepsLog::Deps::nodes</a>, and <a class="el" href="deps__log_8h_source.html#l00114">nodes_</a>.</p>

<p>Referenced by <a class="el" href="deps__log_8cc_source.html#l00043">OpenForWrite()</a>.</p>

</div>
</div>
<a class="anchor" id="a970cd6713ab54b3fff2f9de5255352fc"></a><!-- doxytag: member="DepsLog::RecordDeps" ref="a970cd6713ab54b3fff2f9de5255352fc" args="(Node *node, TimeStamp mtime, const vector&lt; Node * &gt; &amp;nodes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="structDepsLog.html#a970cd6713ab54b3fff2f9de5255352fc">DepsLog::RecordDeps</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structNode.html">Node</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="timestamp_8h.html#a364f6f32873dd70e259c971fc2e28b73">TimeStamp</a>&#160;</td>
          <td class="paramname"><em>mtime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const vector&lt; <a class="el" href="structNode.html">Node</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>nodes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="deps__log_8cc_source.html#l00080">80</a> of file <a class="el" href="deps__log_8cc_source.html">deps_log.cc</a>.</p>

<p>Referenced by <a class="el" href="build_8cc_source.html#l00715">Builder::FinishCommand()</a>.</p>

</div>
</div>
<a class="anchor" id="a5f48df80478fb9af806aa7c56946ca81"></a><!-- doxytag: member="DepsLog::RecordDeps" ref="a5f48df80478fb9af806aa7c56946ca81" args="(Node *node, TimeStamp mtime, int node_count, Node **nodes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="structDepsLog.html#a970cd6713ab54b3fff2f9de5255352fc">DepsLog::RecordDeps</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structNode.html">Node</a> *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="timestamp_8h.html#a364f6f32873dd70e259c971fc2e28b73">TimeStamp</a>&#160;</td>
          <td class="paramname"><em>mtime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>node_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structNode.html">Node</a> **&#160;</td>
          <td class="paramname"><em>nodes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="deps__log_8cc_source.html#l00086">86</a> of file <a class="el" href="deps__log_8cc_source.html">deps_log.cc</a>.</p>

<p>References <a class="el" href="deps__log_8h_source.html#l00101">deps()</a>, <a class="el" href="deps__log_8h_source.html#l00111">file_</a>, <a class="el" href="deps__log_8cc_source.html#l00295">GetDeps()</a>, <a class="el" href="graph_8h_source.html#l00083">Node::id()</a>, <a class="el" href="deps__log_8cc_source.html#l00037">kMaxRecordSize</a>, <a class="el" href="deps__log_8h_source.html#l00081">DepsLog::Deps::mtime</a>, <a class="el" href="deps__log_8h_source.html#l00082">DepsLog::Deps::node_count</a>, <a class="el" href="deps__log_8h_source.html#l00083">DepsLog::Deps::nodes</a>, <a class="el" href="deps__log_8cc_source.html#l00378">RecordId()</a>, and <a class="el" href="deps__log_8cc_source.html#l00367">UpdateDeps()</a>.</p>

</div>
</div>
<a class="anchor" id="aa4cc04faa7d2d9256a372f1b067e61ef"></a><!-- doxytag: member="DepsLog::RecordId" ref="aa4cc04faa7d2d9256a372f1b067e61ef" args="(Node *node)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="structDepsLog.html#aa4cc04faa7d2d9256a372f1b067e61ef">DepsLog::RecordId</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structNode.html">Node</a> *&#160;</td>
          <td class="paramname"><em>node</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="deps__log_8cc_source.html#l00378">378</a> of file <a class="el" href="deps__log_8cc_source.html">deps_log.cc</a>.</p>

<p>References <a class="el" href="deps__log_8h_source.html#l00111">file_</a>, <a class="el" href="deps__log_8cc_source.html#l00037">kMaxRecordSize</a>, <a class="el" href="deps__log_8h_source.html#l00114">nodes_</a>, <a class="el" href="graph_8h_source.html#l00073">Node::path()</a>, and <a class="el" href="graph_8h_source.html#l00084">Node::set_id()</a>.</p>

<p>Referenced by <a class="el" href="deps__log_8cc_source.html#l00086">RecordDeps()</a>.</p>

</div>
</div>
<a class="anchor" id="a35ce8189fffae2b7300d415ce115a0a3"></a><!-- doxytag: member="DepsLog::UpdateDeps" ref="a35ce8189fffae2b7300d415ce115a0a3" args="(int out_id, Deps *deps)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="structDepsLog.html#a35ce8189fffae2b7300d415ce115a0a3">DepsLog::UpdateDeps</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>out_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structDepsLog_1_1Deps.html">Deps</a> *&#160;</td>
          <td class="paramname"><em>deps</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="deps__log_8cc_source.html#l00367">367</a> of file <a class="el" href="deps__log_8cc_source.html">deps_log.cc</a>.</p>

<p>References <a class="el" href="deps__log_8h_source.html#l00101">deps()</a>, and <a class="el" href="deps__log_8h_source.html#l00116">deps_</a>.</p>

<p>Referenced by <a class="el" href="deps__log_8cc_source.html#l00164">Load()</a>, and <a class="el" href="deps__log_8cc_source.html#l00086">RecordDeps()</a>.</p>

</div>
</div>
<hr/><h2>Friends And Related Function Documentation</h2>
<a class="anchor" id="a5aac22285c95db2a3021f748c8aec5b1"></a><!-- doxytag: member="DepsLog::DepsLogTest" ref="a5aac22285c95db2a3021f748c8aec5b1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend struct <a class="el" href="structDepsLog.html#a5aac22285c95db2a3021f748c8aec5b1">DepsLogTest</a><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="deps__log_8h_source.html#l00118">118</a> of file <a class="el" href="deps__log_8h_source.html">deps_log.h</a>.</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="af599cdffb987059f53caf7ebc63e41dd"></a><!-- doxytag: member="DepsLog::deps_" ref="af599cdffb987059f53caf7ebc63e41dd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt;<a class="el" href="structDepsLog_1_1Deps.html">Deps</a>*&gt; <a class="el" href="structDepsLog.html#af599cdffb987059f53caf7ebc63e41dd">DepsLog::deps_</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Maps id -&gt; deps of that id. </p>

<p>Definition at line <a class="el" href="deps__log_8h_source.html#l00116">116</a> of file <a class="el" href="deps__log_8h_source.html">deps_log.h</a>.</p>

<p>Referenced by <a class="el" href="deps__log_8cc_source.html#l00295">GetDeps()</a>, <a class="el" href="deps__log_8cc_source.html#l00303">Recompact()</a>, and <a class="el" href="deps__log_8cc_source.html#l00367">UpdateDeps()</a>.</p>

</div>
</div>
<a class="anchor" id="a95b019cbbc01f5869c86bc790424d834"></a><!-- doxytag: member="DepsLog::file_" ref="a95b019cbbc01f5869c86bc790424d834" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FILE* <a class="el" href="structDepsLog.html#a95b019cbbc01f5869c86bc790424d834">DepsLog::file_</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="deps__log_8h_source.html#l00111">111</a> of file <a class="el" href="deps__log_8h_source.html">deps_log.h</a>.</p>

<p>Referenced by <a class="el" href="deps__log_8cc_source.html#l00158">Close()</a>, <a class="el" href="deps__log_8cc_source.html#l00043">OpenForWrite()</a>, <a class="el" href="deps__log_8cc_source.html#l00086">RecordDeps()</a>, and <a class="el" href="deps__log_8cc_source.html#l00378">RecordId()</a>.</p>

</div>
</div>
<a class="anchor" id="adee980c7d35e5c4b32b669733b4382c4"></a><!-- doxytag: member="DepsLog::needs_recompaction_" ref="adee980c7d35e5c4b32b669733b4382c4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="structDepsLog.html#adee980c7d35e5c4b32b669733b4382c4">DepsLog::needs_recompaction_</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="deps__log_8h_source.html#l00110">110</a> of file <a class="el" href="deps__log_8h_source.html">deps_log.h</a>.</p>

<p>Referenced by <a class="el" href="deps__log_8cc_source.html#l00164">Load()</a>, and <a class="el" href="deps__log_8cc_source.html#l00043">OpenForWrite()</a>.</p>

</div>
</div>
<a class="anchor" id="a6808f42a3e9b5e1a4f0a0664dcebaae3"></a><!-- doxytag: member="DepsLog::nodes_" ref="a6808f42a3e9b5e1a4f0a0664dcebaae3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt;<a class="el" href="structNode.html">Node</a>*&gt; <a class="el" href="structDepsLog.html#a6808f42a3e9b5e1a4f0a0664dcebaae3">DepsLog::nodes_</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Maps id -&gt; <a class="el" href="structNode.html" title="Information about a node in the dependency graph: the file, whether it&#39;s dirty, mtime, etc.">Node</a>. </p>

<p>Definition at line <a class="el" href="deps__log_8h_source.html#l00114">114</a> of file <a class="el" href="deps__log_8h_source.html">deps_log.h</a>.</p>

<p>Referenced by <a class="el" href="deps__log_8cc_source.html#l00164">Load()</a>, <a class="el" href="deps__log_8cc_source.html#l00303">Recompact()</a>, and <a class="el" href="deps__log_8cc_source.html#l00378">RecordId()</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following files:<ul>
<li><a class="el" href="deps__log_8h_source.html">deps_log.h</a></li>
<li><a class="el" href="deps__log_8cc_source.html">deps_log.cc</a></li>
</ul>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Fri Jul 4 2014 09:13:00 for Ninja by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
